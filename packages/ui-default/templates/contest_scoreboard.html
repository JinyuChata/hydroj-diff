{% if UserContext %}{% include "partials/nav.html" %}{% endif %}
{% extends "layout/basic_new.html" %}
{% block content %}
{{ set(UiContext, 'tdoc', tdoc) }}
{{ set(UiContext, 'tsdoc', tsdoc) }}
<div id="root" style="padding-top: 0">
  <!-- 轮播图 -->
  <div>
    <el-carousel :interval="5000" arrow="always" height="300px">
      <el-carousel-item class="el-carousel__item" v-for="item in carouselItems" :key="item.id">
        <img :src="item.imageUrl" class="carousel-image" alt="轮播图">
      </el-carousel-item>
    </el-carousel>
  </div>

  <!-- 标题 -->
  <div class="title" style="margin: 33px 0 25px 0">
    <div style="display: flex; height: 50px; line-height: 50px; position: relative" class="w">
      <div style="font-size: 20px; font-weight: 700; margin-left: 30px;position: relative;">
        CODEMATE
        <div class="titleBorder"></div>
      </div>
      <span style="font-size: 20px; color: #333; margin-left: 20px; font-weight: 400;">竞技场</span>
      <span style="font-size: 20px; color: #333; margin-left: 20px; font-weight: 400;">比赛排名</span>
    </div>
  </div>
  <div class="bottom w" style="display: flex">
    <div class="bottomCenter" style="margin: 0 30px; flex: 1; width: 1010px;">
      <div class="aioj-clearfix" style="margin-bottom: 25px; ">
        <div class="title-content-left">比赛：{{ tdoc.title }}</div>
        <div class="title-content-right01">比赛时间：{{'{{'}} formatDate(startAt) {{'}}'}}</div>
        <div class="title-content-right00">报名人数：{{ tdoc['attend']|default(0) }}人</div>
      </div>
      <el-table :data="nRespData" class="no-hover-effect" :row-style="tableRowStyle">
        <el-table-column prop="rank" label="排名"></el-table-column>
        <el-table-column label="用户名" width="130">
          <template slot-scope="scope">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="none" version="1.1" width="18" height="20" viewBox="0 0 18 20"><g><path d="M9,2C7.34315,2,6,3.34315,6,5C6,6.65685,7.34315,8,9,8C10.6569,8,12,6.65685,12,5C12,3.34315,10.6569,2,9,2C9,2,9,2,9,2ZM4,5C4,2.23858,6.23858,0,9,0C11.7614,0,14,2.23858,14,5C14,7.76142,11.7614,10,9,10C6.23858,10,4,7.76142,4,5C4,5,4,5,4,5ZM1.46447,13.4645C2.40215,12.5268,3.67392,12,5,12C5,12,13,12,13,12C14.3261,12,15.5979,12.5268,16.5355,13.4645C17.4732,14.4021,18,15.6739,18,17C18,17,18,19,18,19C18,19.5523,17.5523,20,17,20C16.4477,20,16,19.5523,16,19C16,19,16,17,16,17C16,16.2044,15.6839,15.4413,15.1213,14.8787C14.5587,14.3161,13.7956,14,13,14C13,14,5,14,5,14C4.20435,14,3.44129,14.3161,2.87868,14.8787C2.31607,15.4413,2,16.2043,2,17C2,17,2,19,2,19C2,19.5523,1.55228,20,1,20C0.447715,20,0,19.5523,0,19C0,19,0,17,0,17C0,15.6739,0.526784,14.4021,1.46447,13.4645C1.46447,13.4645,1.46447,13.4645,1.46447,13.4645Z" fill-rule="evenodd" fill="#FFFFFF" fill-opacity="1"/></g></svg>
            <span style="margin-left: 15px;">{{'{{'}} scope.row.user {{'}}'}}</span>
          </template>
        </el-table-column>
<!--        <el-table-column prop="signature" label="签名" width="500"></el-table-column>-->
        <el-table-column v-for="(pname, index) in nProblems" :label="pname">
          <template slot-scope="scope">
            {{'{{'}} scope.row.problem[pname] {{'}}'}}
          </template>
        </el-table-column>
        <el-table-column prop="total_score" label="总分"></el-table-column>
<!--        <el-table-column prop="city" label="城市"></el-table-column>-->

      </el-table>

      <div style="position: relative; height: 30px; margin-top: 10px;">
        <el-pagination style="position: absolute; left: 50%; transform: translateX(-50%);"
                       :layout="'prev, pager, next'"
                       :current-page="queryParamsObj.current"
                       :page-size="queryParamsObj.size"
                       :total="nTotal"
                       @current-change="pageNoChange"/>
      </div>


    </div>

    <div class="bottomRight" style="width: 210px">
      <el-collapse v-model="activeNames">
        <el-collapse-item name="1">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div style="width: 4px; background-color: #ff7d37; height: 18px; margin: 10px;"></div>
              <span>重要公告</span>
            </div>
          </template>
          <div style="margin: 10px; color: #FF7D37; font-size: 16px;">专项赛</div>
        </el-collapse-item>
        <el-collapse-item name="2">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div style="width: 4px; background-color: #ff7d37; height: 18px; margin: 10px;"></div>
              <span>比赛阶段</span>
            </div>
          </template>
          <div style="margin: 10px; font-size: 16px;">初赛</div>
        </el-collapse-item>

        <el-collapse-item name="3">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div style="width: 4px; background-color: #ff7d37; height: 18px; margin: 10px;"></div>
              <span>举办方</span>
            </div>
          </template>
          <div style="margin: 10px; font-size: 16px;">大赛组委会</div>
        </el-collapse-item>

        <el-collapse-item name="4">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div style="width: 4px; background-color: #ff7d37; height: 18px; margin: 10px;"></div>
              <span>比赛答疑</span>
            </div>
          </template>
          <div style="margin: 10px; font-size: 16px; color: #FF7D37;">前往本次比赛答疑专区</div>
        </el-collapse-item>

        <el-collapse-item name="5">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div style="width: 4px; background-color: #ff7d37; height: 18px; margin: 10px;"></div>
              <span>比赛排名</span>
            </div>
          </template>
          <div style="margin: 10px; font-size: 16px; color: #FF7D37;">本次比赛完整排名</div>
        </el-collapse-item>

      </el-collapse>
    </div>

  </div>
</div>
<script>
    new Vue({
        el: '#root',
        data() {
            return {
                queryParamsObj: { current: 1, size: 10 },
                tableRowStyle: {height: '60px', backgroundColor: '#FF7D37', color: '#FFF'},
                nRespData: [],
                nTotal: 0,
                nProblems: [],
                inputContent: '',
                activeNames: ['1', '2', '3', '4', '5'],
                url: 'http://jsonplaceholder.typicode.com/posts',
                params: '',
                tabs: '',
                startAt: Date(),

                carouselItems: [
                    { id: 1, imageUrl: "{{ UiContext.cdn_prefix }}img/lunbotu/lunbotu.jpg" },
                    { id: 2, imageUrl: "{{ UiContext.cdn_prefix }}img/lunbotu/lunbotu.jpg" },
                    { id: 3, imageUrl: "{{ UiContext.cdn_prefix }}img/lunbotu/lunbotu.jpg" },
                    { id: 4, imageUrl: "{{ UiContext.cdn_prefix }}img/lunbotu/lunbotu.jpg" },
                ]
            };
        },
        methods: {
            tabsFn() {
            },
            formatDate(dateString) {
                const date = new Date(dateString);
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const hours = String(date.getHours()).padStart(2, '0');
                const minutes = String(date.getMinutes()).padStart(2, '0');
                return `${year}-${month}-${day} ${hours}:${minutes}`;
            },
            async getTableData() {
                let url = `/api/contest/{{tdoc.docId}}/scoreboard`
                console.log(url);
                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        console.log(data)
                        this.startAt = data['tdoc']['beginAt']
                        const nData = []
                        const nProblem = []
                        data['rows'].forEach((row, i) => {
                            const dt = {}
                            if (i === 0) {
                                row.forEach((r) => {
                                    if (r['type'] === 'problem') nProblem.push(r['value'])
                                })
                            } else {
                                let problem = 0
                                console.log(nProblem)
                                dt['problem'] = {}
                                row.forEach((r) => {
                                    if (r['type'] === 'record') {
                                        dt['problem'][nProblem[problem]] = r['value']
                                        problem ++
                                    } else {
                                        dt[r['type']] = r['value']
                                    }
                                })
                                nData.push(dt)
                            }
                        })
                        this.nRespData = nData
                        this.nProblems = nProblem
                        this.nTotal = nData.length
                        console.log("ndata", this.nRespData)
                    })
            },
            // 修改页码
            pageNoChange: function(value) {
                this.queryParamsObj.current = value

                console.log('这里逻辑自己处理，是动态分页还是静态分页看后台代码')
                // TODO 这里逻辑自己处理，是动态分页还是静态分页看后台代码
            }
        },
        mounted() {
            console.log("")

            this.getTableData();
        },
    });

</script>
{% endblock %}
{% block style %}

* {
padding: 0;
margin: 0;
box-sizing: border-box;
font-size: 16px;
font-family: 'PingFang-SC-Regular';
list-style: none;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

body {
}

.has-gutter {
background-color: #f9f9f9 !important;
}

#root {
background: #fff;
padding-top: 75px;
}

/* 版心 */
.w {
width: 1280px;
margin: 0 auto;
}

header {
background-color: #fff;
position: fixed;
top: 0;
width: 100%;
z-index: 99999;
height: 75px;
}

header .header {
display: flex;
align-items: center;
justify-content: space-between;
}

.header #logo {
height: 75px;
}

.header-center {
flex: 2;
margin-left: 130px;
}

.header-center ul {
display: flex;
}

.header-center ul li {
margin: 0 10px;
position: relative;
height: 35px;
line-height: 35px;
cursor: pointer;
}

.liActive {
color: #ff7d37;
font-weight: 600;
}

.header-center ul .liActive::before {
content: '';
/* 必须有内容才能显示伪元素 */
position: absolute;
left: 50%;
bottom: 0;
/* 放在底部 */
width: 50%;
/* 宽度等于父元素宽度 */
border-bottom: 3px solid #ff7d37;
/* 边框样式不变 */
transform: translateX(-50%);
/* 将元素向左移动自身宽度的一半，实现居中 */
}

.header-right {
flex: 1;
display: flex;
align-items: center;
justify-content: flex-end;
}

.header-right .Avatar img {
border-radius: 50%;
}

.header-right .inputBox {
background-color: #fff;
padding: 5px 10px;
width: 100px;
margin: 0 20px;
border: 1px solid #ccc;
font-size: 12px;
}

.header-right input {
border: none;
outline: none;
font-size: 12px;
width: 100%;
}

.el-tabs__item:hover {
color: #ff7d37;
cursor: pointer;
}

.is-active {
/*color: #ff7d37 !important;*/
}

.el-tabs__active-bar {
background-color: #ff7d37;
}

.el-collapse {
border-top: none;
}
.el-carousel__item {
width: 100%;
display: flex;
align-items: center;
justify-content: center;
.carousel-image {
max-width: 100%;
max-height: 100%;
}
}
.el-carousel__item h3 {
font-size: 14px;
opacity: 0.75;
line-height: 200px;
margin: 0;
}


.bottomCenter ul li {
cursor: pointer;
}

.footer {
display: flex;
padding-top: 40px;
}

.footer-right {
display: flex;
justify-content: space-between;
flex: 1;
margin-left: 90px;
font-size: 16px;
}

.footer-right .rightItem {
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
}

.footer-right .rightItem p {
color: #000;
}

.footer-right .rightItem div {
margin-top: 10px;
color: #797979;
}

.tabsAll {
position: fixed;
/* 居中靠左 */
left: 0;
top: 50%;
}

.tabs {
/* 矩形 42 */
width: 153px;
height: 60px;
border-radius: 0px 40px 40px 0px;
opacity: 1;
background: #ff7d37;
box-shadow: 4px 2px 10px 0px #fff0e7;
z-index: 1000;
margin-top: 8px;
cursor: pointer;
}

.el-table th.el-table__cell > .cell {
font-size: 14px;
font-weight: 400;
}

.el-tabs__item {
font-size: 18px;
}

.titleBorder {
position: absolute;
top: 33px;
width: 114px;
height: 4px;
opacity: 1;
background: #ff7d37;
}

/* █████████████████████████████████████████ 代码护城河 █████████████████████████████████████████ */
.aioj-clearfix:after {
display: block;
clear: both;
content: "";
visibility: hidden;
height: 0;
}


.no-hover-effect .el-table__body tr:hover>td.el-table__cell {
background: inherit !important; /* 使用 !important 确保覆盖默认样式 */
}

.title-content-left {
float: left;
display: inline-block;

height: 32px;
line-height: 32px;
font-family: Microsoft YaHei;
font-size: 24px;
font-weight: bold;
color: #3D3D3D;
}

.title-content-right00 {
float: right;
display: inline-block;

height: 32px;
line-height: 32px;
font-family: Microsoft YaHei;
font-size: 24px;
font-weight: bold;
color: #FF7D37;
}

.title-content-right01 {
float: right;
display: inline-block;

width: 190px;
height: 32px;
line-height: 32px;
background-color: #F9F9F9;
font-family: Microsoft YaHei;
font-size: 14px;
color: #797979;

margin-left: 30px;
}
{% endblock %}