{% import "components/record.html" as record with context %}
{% import "components/problem.html" as problem with context %}
{% extends "layout/basic.html" %}
{% block content %}
<div class="row">
  <div class="medium-9 columns">
    <div style="padding-bottom: 30px">
      <form method="get" id="searchForm" action="{{ url('problem_main_tag') }}">
        <div class="filter">
          <label for="language">语言选择:</label>
          <select id="language" onchange="">
            {% if ilanguage == "C++" %}
              <option value="C++" selected>C++</option>
              <option value="Python">Python</option>
            {% elif ilanguage == "Python" %}
              <option value="C++" >C++</option>
              <option value="Python" selected>Python</option>
            {% else %}
              <option value="C++">C++</option>
              <option value="Python">Python</option>
            {% endif %}
          </select>
          <br>
          <label for="competition">赛事选择:</label>
          <select id="competition" onchange="updateOptions()">
            {% if icompetition == "GESP" %}
            <option value="GESP" selected>GESP</option>
            <option value="电子学会">电子学会</option>
            <option value="蓝桥杯">蓝桥杯</option>
            {% elif icompetition == "电子学会" %}
            <option value="GESP">GESP</option>
            <option value="电子学会" selected>电子学会</option>
            <option value="蓝桥杯">蓝桥杯</option>
            {% elif icompetition == "蓝桥杯" %}
            <option value="GESP">GESP</option>
            <option value="电子学会">电子学会</option>
            <option value="蓝桥杯" selected>蓝桥杯</option>
            {% else %}
            <option value="GESP">GESP</option>
            <option value="电子学会">电子学会</option>
            <option value="蓝桥杯">蓝桥杯</option>
            {% endif %}
          </select>
          <br>
          <label for="level">级别选择:</label>
          <select id="level">
          </select>

<!--          <input name="tags" id="tags" type="text" hidden="hidden" value="">-->
          <input name="lastLevel" id="lastLevel" type="text" hidden="hidden" value="{{ ilevel }}">
          <input name="ilanguage" id="ilanguage" type="text" hidden="hidden" value="">
          <input name="icompetition" id="icompetition" type="text" hidden="hidden" value="">
          <input name="ilevel" id="ilevel" type="text" hidden="hidden" value="">

          <el-button type="success" onclick="submitForm()">Filter</el-button>
        </div>
      </form>

    </div>
    <div class="section display-mode">
      <div class="section__body no-padding">
        {% include "partials/problem_list.html" %}
      </div>
    </div>
  </div>
  <div class="medium-3 columns">
    {% if handler.user.hasPriv(PRIV.PRIV_USER_PROFILE) %}
    <div class="section side nojs--hide">
      <ol class="menu">
        <a href="javascript:;" class="menu__link edit-mode-hide" name="enter-edit-mode">
          <span class="icon icon-edit"></span>
          {{ _('Enter Edit Mode') }}
        </a>
        <a href="javascript:;" class="menu__link display-mode-hide" name="leave-edit-mode">
          <span class="icon icon-edit"></span>
          {{ _('Leave Edit Mode') }}
        </a>
        {% if handler.user.hasPerm(perm.PERM_EDIT_PROBLEM) %}
        <a href="javascript:;" class="menu__link display-mode-hide" name="hide_selected_problems">
          <span class="icon icon-close"></span>
          {{ _('Hide Selected') }}
        </a>
        <a href="javascript:;" class="menu__link display-mode-hide" name="unhide_selected_problems">
          <span class="icon icon-check"></span>
          {{ _('Unhide Selected') }}
        </a>
        <a href="javascript:;" class="menu__link display-mode-hide" name="download_selected_problems">
          <span class="icon icon-download"></span>
          {{ _('Download Selected') }}
        </a>
        <a href="javascript:;" class="menu__link display-mode-hide" name="delete_selected_problems">
          <span class="icon icon-delete"></span>
          {{ _('Remove Selected') }}
        </a>
        {% endif %}
        <a href="javascript:;" class="menu__link display-mode-hide" name="copy_selected_problems">
          <span class="icon icon-copy"></span>
          {{ _('Copy Selected') }}
        </a>
      </ol>
    </div>
    {% endif %}
    {% if handler.user.hasPerm(perm.PERM_CREATE_PROBLEM) %}
    <div class="section side">
      <div class="section__header">
        <h1 class="section__title">{{ _('Create Problem') }}</h1>
      </div>
      <ol class="menu">
        {%- for item in ui.getNodes('ProblemAdd') -%}
        <a href="{{ url(item.name, item.args) }}" class="menu__link">
          <span class="icon icon-{{ item.args.icon|default('add') }}"></span>
          {{ _(item.args.text) }}
        </a>
        {%- endfor -%}
      </ol>
      <div class="section__body">
        <div class="typo supplementary">
          <p>{{ _('You have permission to create problems for this domain.') }}</p>
        </div>
      </div>
    </div>
    {% endif %}
    <div class="section side">
      <div class="section__header edit-mode-hide">
        <h1 class="section__title">{{ _('Categories') }}</h1>
      </div>
      <div class="section__body">
        {% include "partials/category.html" %}
      </div>
      <div class="section__body edit-mode-hide">
        {% include "partials/problem_lucky.html" %}
      </div>
    </div>
  </div>
</div>
<script>
    function updateOptions(init=false) {
        console.log("updateOption")
        var language = document.getElementById("language").value;
        var competition = document.getElementById("competition");
        var level = document.getElementById("level");

        // 清空赛事和级别的选项
        level.innerHTML = "";

        // 添加级别选项
        if (competition.value === "GESP") {
            addOption(level, "GESP:一级", "GESP:一级", init);
            addOption(level, "GESP:二级", "GESP:二级", init);
            addOption(level, "GESP:三级", "GESP:三级", init);
        } else {
            addOption(level, "N/A", "N/A", init);
        }
    }

    function addOption(selectElement, text, value, init=false) {
        var option = document.createElement("option");
        option.text = text;
        option.value = value;

        const lastLevel = document.getElementById("lastLevel").value;
        console.log("lastLevel", lastLevel)

        if (init) {
            console.log("init", value, lastLevel)
            if (value === lastLevel) {
                option.selected = true
            }
            console.log(option)
        }
        selectElement.add(option);
    }

    function submitForm() {
        const languageValue = document.getElementById("language").value;
        const competitionValue = document.getElementById("competition").value;
        const levelValue = document.getElementById("level").value;

        const tags = []

        // 初始化空字符串
        const tagsValue = "";

        // 添加条件，仅在值不是 "N/A" 时才拼接到字符串中
        document.getElementById("ilanguage").value = languageValue;

        document.getElementById("icompetition").value = competitionValue;

        document.getElementById("ilevel").value = levelValue;

        document.getElementById("searchForm").submit();
    }

    document.addEventListener("DOMContentLoaded", function() {
        updateOptions(true)
    });


</script>
{% endblock %}