{% if UserContext %}{% include "partials/nav.html" %}{% endif %}
{% extends "layout/basic_new.html" %}
{%- macro nav_item(item) -%}

      <div
              class="timeOverTags"
              style="
                margin: 0 10px 0 0;
                padding: 0 10px;
                font-size: 16px;
                text-align: center;
                line-height: 40px;
                color: #fff;
                height: 40px;
                border-radius: 8px;
                opacity: 1;
                background: #ff7d37;
              "
      >
      <a href="{{ url(item.name, item.args, query=item.args.query(handler) if typeof(item.args.query) == 'function' else item.args.query or {}) }}" style="color: #FFFFFF">
      {{ _(item.displayName or item.name) }}
      </a>
    </div>
{%- endmacro -%}

{% import "components/contest.html" as contest with context %}
{% import "components/record.html" as record with context %}
{% import "components/problem.html" as problem with context %}
{% block content %}
{{ set(UiContext, 'tdoc', tdoc) }}
{{ set(UiContext, 'tsdoc', tsdoc) }}

<!-- 标题 -->
<div id="root">
  <div class="title" style="margin: 33px 0 0px 0">
    <div style="display: flex; height: 50px; line-height: 50px" class="w">
      <div
              style="
              font-size: 20px;
              font-weight: 700;
              margin-left: 30px;
              position: relative;
            "
      >
        CODEMATE
        <div class="titleBorder"></div>
      </div>
      <span
              style="
              font-size: 20px;
              color: #333;
              margin-left: 20px;
              font-weight: 400;
            "
      >竞技场</span>
    </div>
  </div>
  <div class="bottom w" style="display: flex; background-color:#fff;">
    <div class="bottomCenter" style="margin: 0 20px; flex: 1">
      <div class="code">
        <div class="name">比赛：{{ tdoc.title }}</div>
        <div class="userNum">参赛人数：{{ tdoc['attend']|default(0) }}人</div>
      </div>
      <div class="tags">
        <div class="tagsLeft">
          <div class="tagsLeftItem" style="color: #797979;">语言：C++</div>
          <!--        {% if tdoc['tag'].length %}-->
          <!--        <div class="tagsLeftItem" style="color: #797979;">{{ tdoc['tag'] }}</div>-->
          <!--        {% endif %}-->
          <div class="tagsLeftItem" style="color: #797979;">组织者：{{ user.render_inline(udict[tdoc.owner], badge=false)
            }}
          </div>
          <div class="tagsLeftItem" style="color: #797979;">赛制：{{ _(model.contest.RULES[tdoc.rule].TEXT) }}</div>
          <!--        <div class="tagsLeftItem" style="color: #797979;">阶段：初赛</div>-->
          <div class="tagsLeftItem" style="color: #797979;">时长：{{ contest.render_duration(tdoc) }} {{ _('hour(s)') }}
          </div>
        </div>
        {% if tsdoc.attend %}
        <div class="tagsRight">已报名</div>
        {% else %}
        <div class="tagsRight">{{ _(model.contest.statusTextNewCheckin(tdoc, tsdoc)) }}</div>
        {% endif %}
      </div>
      {% if tdoc['importantContent'] %}
      <div
              class="infoTitle"
              style="
              margin: 20px 0 10px 0;
              font-size: #3d3d3d;
              font-weight: 700;
              font-size: 18px;
            "
      >
        重要信息
      </div>
      <div style="font-size: 16px;line-height: 29px;">
        {{ tdoc['importantContent']|markdown|safe }}
      </div>
      <div
              class="timeOver"
              style="
              display: flex;
              justify-content: space-between;
              margin-top: 30px;
            "
      >
        <div style="color: #ff0000; font-size: 16px">
          {% if tsdoc.attend %}
          已报名
          {% else %}
          报名倒计时：{{'{{'}} countdown {{'}}'}}
          {% endif %}
        </div>

        <div style="display: flex">
          {% if tsdoc.attend %}
          <!-- Attend-->
          {% if model.contest.isBeforeGoing(tdoc, tsdoc) %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            已报名，比赛未开始
          </div>
          {% elif model.contest.isOngoing(tdoc, tsdoc) %}
          {% else %}
          <div
                  class="timeOverTags"
                  style="
                      margin: 0 10px;
                      padding: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            已报名，比赛已结束
          </div>
          {% endif %}
          {%- for item in overrideNav|default(ui.getNodes('Nav')) -%}
          {% if item.checker(handler) %}
          {{ nav_item(item) }}
          {% endif %}
          {%- endfor -%}

          {% else %}
          <!--          Not Attend-->
          {% if model.contest.isDone(tdoc, tsdoc) %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            已结束
          </div>
          {% elif model.contest.isBeforeCheckin(tdoc) %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            报名未开始
          </div>
          {% elif model.contest.isOnCheckin(tdoc) %}
          <form action="{{ url('contest_detail', tid=tdoc.docId) }}" method="POST">
            <input type="hidden" name="operation" value="attend">
            <button class="menu__link" {% if tdoc._code %}data-contest-code{% endif %} type="submit"
                    style="border: none; padding: 0">
              <div
                      class="timeOverTags"
                      style="
                  padding: 0 10px;
                  font-size: 16px;
                  text-align: center;
                  line-height: 40px;
                  color: #fff;
                  height: 40px;
                  border-radius: 8px;
                  opacity: 1;
                  background: #ff7d37;
                "
              >
                马上报名
              </div>
            </button>
          </form>
          {% else %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            报名已结束
          </div>
          {% endif %}
          {% endif %}
          <div
                  class="timeOverTags"
                  style="
                  margin: 0 10px;
                  padding: 0 10px;
                  font-size: 16px;
                  text-align: center;
                  line-height: 40px;
                  height: 40px;
                  border-radius: 8px;
                  color: #ff7d37;
                  opacity: 1;

                  box-sizing: border-box;
                  border: 1px solid #ff7d37;
                "
          >
            保持关注
          </div>
          <div
                  class="timeOverTags"
                  style="
                  padding: 0 10px;
                  font-size: 16px;
                  text-align: center;
                  line-height: 40px;
                  height: 40px;
                  border-radius: 8px;
                  opacity: 1;
                  color: #2e77e3;
                  box-sizing: border-box;
                  border: 1px solid #2e77e3;
                "
          >
            分享转发
          </div>
        </div>
      </div>
      {% endif %}

      <div
              class="infoTitle"
              style="
              margin: 20px 0 10px 0;
              font-size: #3d3d3d;
              font-weight: 700;
              font-size: 18px;
            "
      >
        比赛内容
      </div>

      <div style="font-size: 16px;line-height: 29px;">
        {{ tdoc['content']|markdown|safe }}
      </div>
      <div
              class="timeOver"
              style="
              display: flex;
              justify-content: space-between;
              margin-top: 30px;
            "
      >

        <div style="color: #ff0000; font-size: 16px">
          {% if tsdoc.attend %}
          已报名
          {% else %}
          报名倒计时：{{'{{'}} countdown {{'}}'}}
          {% endif %}

        </div>
        <div style="display: flex">
          {% if tsdoc.attend %}
          <!-- Attend-->
          {% if model.contest.isBeforeGoing(tdoc, tsdoc) %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            已报名，比赛未开始
          </div>
          {% elif model.contest.isOngoing(tdoc, tsdoc) %}
          {% else %}
          <div
                  class="timeOverTags"
                  style="
                      margin: 0 10px;
                      padding: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            已报名，比赛已结束
          </div>
          {% endif %}
          {%- for item in overrideNav|default(ui.getNodes('Nav')) -%}
          {% if item.checker(handler) %}
          {{ nav_item(item) }}
          {% endif %}
          {%- endfor -%}

          {% else %}
          <!--          Not Attend-->
          {% if model.contest.isDone(tdoc, tsdoc) %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            已结束
          </div>
          {% elif model.contest.isBeforeCheckin(tdoc) %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            报名未开始
          </div>
          {% elif model.contest.isOnCheckin(tdoc) %}
          <form action="{{ url('contest_detail', tid=tdoc.docId) }}" method="POST">
            <input type="hidden" name="operation" value="attend">
            <button class="menu__link" {% if tdoc._code %}data-contest-code{% endif %} type="submit"
                    style="border: none; padding: 0">
              <div
                      class="timeOverTags"
                      style="
                  padding: 0 10px;
                  font-size: 16px;
                  text-align: center;
                  line-height: 40px;
                  color: #fff;
                  height: 40px;
                  border-radius: 8px;
                  opacity: 1;
                  background: #ff7d37;
                "
              >
                马上报名
              </div>
            </button>
          </form>
          {% else %}
          <div
                  class="timeOverTags"
                  style="
                      padding: 0 10px;
                      margin: 0 10px;
                      font-size: 16px;
                      text-align: center;
                      line-height: 40px;
                      color: #fff;
                      height: 40px;
                      border-radius: 8px;
                      opacity: 1;
                      background: #ff7d37;
                    "
          >
            报名已结束
          </div>
          {% endif %}
          {% endif %}
          <div
                  class="timeOverTags"
                  style="
                  margin: 0 10px;
                  padding: 0 10px;
                  font-size: 16px;
                  text-align: center;
                  line-height: 40px;
                  height: 40px;
                  border-radius: 8px;
                  color: #ff7d37;
                  opacity: 1;

                  box-sizing: border-box;
                  border: 1px solid #ff7d37;
                "
          >
            保持关注
          </div>
          <div
                  class="timeOverTags"
                  style="
                  padding: 0 10px;
                  font-size: 16px;
                  text-align: center;
                  line-height: 40px;
                  height: 40px;
                  border-radius: 8px;
                  opacity: 1;
                  color: #2e77e3;
                  box-sizing: border-box;
                  border: 1px solid #2e77e3;
                "
          >
            分享转发
          </div>
        </div>

      </div>
    </div>

    <div class="bottomRight" style="width: 300px">
      <el-collapse v-model="activeNames">
        <el-collapse-item name="1">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div
                      style="
                      width: 4px;
                      background-color: #ff7d37;
                      height: 18px;
                      margin: 10px;
                    "
              ></div>
              <span>比赛类别</span>
            </div>
          </template>
          <div style="padding: 10px">
            可以折叠/展开的内容区域，用于对复杂区域进行分组和隐藏，保持页面的整洁。
          </div>
          <div style="padding: 10px">
            可以折叠/展开的内容区域，用于对复杂区域进行分组和隐藏，保持页面的整洁。
          </div>
        </el-collapse-item>
        <div style="color: #FF7D37;margin: 20px 0;font-size: 16px;">诸侯赛</div>
        <el-collapse-item name="2">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div
                      style="
                      width: 4px;
                      background-color: #ff7d37;
                      height: 18px;
                      margin: 10px;
                    "
              ></div>
              <span>比赛阶段</span>
            </div>
          </template>
          <div style="padding: 10px">
            可以折叠/展开的内容区域，用于对复杂区域进行分组和隐藏，保持页面的整洁。
          </div>
          <div style="padding: 10px">
            可以折叠/展开的内容区域，用于对复杂区域进行分组和隐藏，保持页面的整洁。
          </div>
        </el-collapse-item>
        <div style="margin: 20px 0;font-size: 16px;">初赛</div>
        <el-collapse-item name="3">
          <template slot="title">
            <div style="display: flex; align-items: center">
              <div
                      style="
                      width: 4px;
                      background-color: #ff7d37;
                      height: 18px;
                      margin: 10px;
                    "
              ></div>
              <span>举办方</span>
            </div>
          </template>
          <div style="padding: 10px">
            可以折叠/展开的内容区域，用于对复杂区域进行分组和隐藏，保持页面的整洁。
          </div>
          <div style="padding: 10px">
            可以折叠/展开的内容区域，用于对复杂区域进行分组和隐藏，保持页面的整洁。
          </div>
        </el-collapse-item>
      </el-collapse>
      <div style="margin: 20px 0;font-size: 16px;">大赛组委会</div>
    </div>
  </div>
  {% endblock %}

  {% block script %}
  <script>
      new Vue({
          el: '#root',
          data() {
              return {
                  activeNames: ['1', '2', '3', '4', '5'],
                  checkinEndAt: new Date("{{ tdoc['checkinEndAt'] }}").getTime(),
                  countdown: "",
              };
          },
          methods: {
              updateCountdown() {
                  const currentTime = new Date().getTime(); // 获取当前时间的时间戳
                  const timeDiff = this.checkinEndAt - currentTime; // 计算时间差
                  if (timeDiff > 0) {
                      const seconds = Math.floor((timeDiff / 1000) % 60);
                      const minutes = Math.floor((timeDiff / 1000 / 60) % 60);
                      const hours = Math.floor((timeDiff / (1000 * 60 * 60)) % 24);
                      const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                      // 格式化倒计时字符串
                      this.countdown = `${days} 天 ${hours} 小时 ${minutes} 分钟 ${seconds} 秒`;
                  } else {
                      this.countdown = '已结束'; // 时间到达目标时间时显示已结束
                      clearInterval(this.timer); // 停止定时器
                  }
              }
          },
          mounted: function () {
              console.log('checkinEnd', this.checkinEndAt)
              this.updateCountdown()
              this.timer = setInterval(() => {
                  this.updateCountdown()
              }, 1000);
          },
          destroyed() {
              clearInterval(this.timer); // 组件销毁时清除定时器
          },
      });

  </script>
  {% endblock %}

  {% block style %}
  * {
  padding: 0;
  margin: 0;
  box-sizing: border-box;
  list-style: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  }
  .has-gutter {
  background-color: #f9f9f9 !important;
  }

  #root {
  background: #fff;
  padding-top: 35px;
  }

  /* 版心 */
  .w {
  width: 1280px;
  margin: 0 auto;
  }

  header {
  background-color: #fff;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 99999;
  height: 75px;
  }

  header .header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  }

  .header #logo {
  height: 75px;
  }

  .header-center {
  flex: 1;
  margin-left: 30px;
  }

  .header-center ul {
  display: flex;
  width: 100%;
  }

  .header-center ul li {
  margin: 0 13px;
  position: relative;
  height: 35px;
  line-height: 35px;
  }

  .liActive {
  color: #ff7d37;
  font-weight: 600;
  }

  .header-center ul .liActive::before {
  content: '';
  /* 必须有内容才能显示伪元素 */
  position: absolute;
  left: 50%;
  bottom: 0;
  /* 放在底部 */
  width: 50%;
  /* 宽度等于父元素宽度 */
  border-bottom: 3px solid #ff7d37;
  /* 边框样式不变 */
  transform: translateX(-50%);
  /* 将元素向左移动自身宽度的一半，实现居中 */
  }

  .header-right {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  }

  .header-right .Avatar img {
  border-radius: 50%;
  }

  .header-right .inputBox {
  background-color: #fff;
  padding: 5px 10px;
  width: 100px;
  margin: 0 20px;
  border: 1px solid #ccc;
  font-size: 12px;
  }

  .header-right input {
  border: none;
  outline: none;
  font-size: 12px;
  width: 100%;
  }

  .el-tabs__item:hover {
  color: #ff7d37;
  }

  .is-active {
  color: #ff7d37 !important;
  }

  .el-tabs__active-bar {
  background-color: #ff7d37;
  }

  .el-collapse {
  border-top: none;
  }

  .el-carousel__item h3 {
  color: #d8d8d8;
  font-size: 14px;
  opacity: 0.75;
  line-height: 200px;
  margin: 0;
  }

  .el-carousel__item:nth-child(2n) {
  background-color: #d8d8d8;
  }

  .el-carousel__item:nth-child(2n + 1) {
  background-color: #d8d8d8;
  }

  .footer {
  display: flex;
  padding-top: 40px;
  }

  .footer-right {
  display: flex;
  justify-content: space-between;
  flex: 1;
  margin-left: 90px;
  font-size: 16px;
  }

  .footer-right .rightItem {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  }

  .footer-right .rightItem p {
  color: #000;
  }

  .footer-right .rightItem div {
  margin-top: 10px;
  color: #797979;
  }

  .tabsAll {
  position: fixed;
  /* 居中靠左 */
  left: 0;
  top: 50%;
  }

  .tabs {
  /* 矩形 42 */
  width: 153px;
  height: 60px;
  border-radius: 0px 40px 40px 0px;
  opacity: 1;
  background: #ff7d37;
  box-shadow: 4px 2px 10px 0px #fff0e7;
  z-index: 1000;
  margin-top: 8px;
  }

  .el-table th.el-table__cell > .cell {
  font-size: 14px;
  font-weight: 400;
  }

  .el-tabs__item {
  font-size: 18px;
  }

  .titleBorder {
  position: absolute;
  top: 33px;
  width: 114px;
  height: 4px;
  opacity: 1;
  background: #ff7d37;
  }

  .el-pager li.active {
  color: #ff7d37;
  cursor: default;
  }

  .el-pager li:hover {
  color: #ff7d37;
  cursor: default;
  }

  .paginationRoot {
  display: flex;
  width: 100%;
  margin-top: 30px;
  align-items: center;
  color: #3d3d3d;
  justify-content: center;
  }

  .backPage {
  font-size: 14px;
  font-weight: 400;
  }

  .nextPage {
  font-size: 14px;
  font-weight: 400;
  }
  .bottomLeft-item {
  width: 161px;
  height: 51px;
  opacity: 1;
  line-height: 51px;
  background: #f7f5f5;
  display: flex;
  padding: 0 20px;
  box-sizing: border-box;
  justify-content: space-between;
  }
  .bottomLeft-itemActive {
  width: 161px;
  height: 51px;
  opacity: 1;
  line-height: 51px;
  display: flex;
  padding: 0 20px;
  box-sizing: border-box;
  justify-content: space-between;
  background: #ff7d37;
  color: #fff;
  font-weight: 700;
  font-size: 16px;
  }

  .centerItem {
  width: 100%;
  height: 180px;
  display: flex;
  justify-content: space-between;
  margin-bottom: 60px;
  }
  .centerItem-left {
  width: 300px;
  height: 180px;
  background-color: #eeeeee;
  margin-right: 27px;
  }
  .centerItem-right {
  flex: 1;
  height: 180px;
  }
  .centerItem-right .rightTitle {
  display: flex;
  justify-content: space-between;
  }
  .centerItem-right .rightTitle .rightTile-Tag {
  width: 80px;
  height: 30px;
  border-radius: 100px 0px 0px 100px;
  font-size: 14px;
  font-weight: 400;
  opacity: 1;
  background: #f1f1f1;
  text-align: center;
  line-height: 30px;
  }
  .centerItem-right .rightContent {
  display: flex;
  margin-top: 17px;
  margin-bottom: 20px;
  font-weight: 400;
  font-size: 16px;
  }

  .centerItem-right .rightBottom {
  display: flex;
  justify-content: space-between;
  height: 50px;
  align-items: center;
  }
  .centerItem-right .rightBottom .bottomTime {
  font-size: 14px !important;
  font-family: Microsoft YaHei;
  }
  .centerItem-right .rightBottom .viewDeatil {
  width: 84px;
  height: 33px;
  line-height: 33px;
  border-radius: 8px;
  text-align: center;
  opacity: 1;
  color: #fff;
  background: #ff7d37;
  font-size: 14px !important;
  font-family: Microsoft YaHei;
  }
  .bottomCenter .code {
  display: flex;
  justify-content: space-between;
  margin: 30px 0;
  }
  .code .name {
  opacity: 1;
  font-family: Microsoft YaHei;
  font-size: 24px;
  font-weight: bold;
  line-height: normal;
  letter-spacing: 0em;
  color: #3d3d3d;
  }
  .code .userNum {
  opacity: 1;
  font-family: Microsoft YaHei;
  font-size: 24px;
  font-weight: bold;
  line-height: normal;
  letter-spacing: 0em;
  color: #ff7d37;
  }
  .tags {
  display: flex;
  justify-content: space-between;
  }
  .tagsLeft {
  display: flex;
  flex: 1;
  }
  .tagsLeft .tagsLeftItem {
  width: 165px;
  height: 35px;
  opacity: 1;
  background: #f9f9f9;
  font-size: 14px;
  line-height: 35px;
  text-align: center;
  flex: 1
  }
  .tagsRight {
  width: 110px;
  height: 35px;
  border-radius: 8px;
  opacity: 1;
  background: rgba(255, 125, 55, 0.16);
  line-height: 35px;
  text-align: center;
  color: #ff7d37;
  margin-left: 30px;
  }

  {% endblock %}
